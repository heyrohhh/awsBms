services:
 
    database:
        image: mysql:8.0
        container_name: mysql
        environment:
         MYSQL_ROOT_PASSWORD: Rohit@123
         MYSQL_DATABASE: book_db
        volumes:
               - mysql_data:/var/lib/mysql
               - ./database/schema.sql:/docker-entrypoint-initdb.d/schema.sql
        restart: unless-stopped
    backend:
        image: heyrohhh/awbms-backend:v2
        restart: unless-stopped
        env_file:
         - .env
        depends_on:
           - database
    frontend:
       image: heyrohhh/awbmsfrontend:v2
       depends_on:
        - backend
    nginx:
     image: nginx:latest
     container_name: nginx-proxy
     ports:
      - "80:80"
      - "443:443"
     volumes:
      - ./nginx/conf:/etc/nginx/conf.d
      - ./certbot/conf:/etc/letencrypt
      - ./certbot/www:/var/www/certbot
     depends_on:
      - frontend
      - backend

    certbot:
     image: certbot/certbot
     volumes:
      - ./certbot/conf:/etc/letsencrypt
      - ./certbot/www:/var/www/certbot
      
volumes:
  mysql_data: